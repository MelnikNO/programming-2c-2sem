# Лабораторная работа № 5

## Задание
**Цель задания**
Разработать веб-приложение на языке Python с использованием фреймворка Flask, реализующее архитектуру MVC (Model-View-Controller). Приложение должно получать курсы указанных валют с сайта Центробанка РФ и отображать их пользователю. В реализации необходимо использовать объектно-ориентированный подход, шаблонизатор Jinja2 и SQLite3 для хранения данных.

**Требования к функционалу**

***1. Компонент Model:***
* Принимает список кодов валют (например, ['USD', 'EUR', 'GBP']);
* Отправляет запрос к сайту Центробанка РФ и получает данные о курсах;

* Реализует геттер для получения текущих отслеживаемых валют и их курсов;

* Реализует сеттер для изменения списка отслеживаемых валют;

* Реализован по паттерну проектирования Singleton (Одиночка) — в приложении может существовать только один экземпляр CurrencyRates.

* Для работы с данными и базой данных используется ORM (например, SQLAlchemy или Django ORM).  

***2. Компонент View:***

* Использует шаблонизатор Jinja2 для отображения данных.

* Позволяет пользователю просматривать курсы валют в удобном формате.

***3. Компонент Controller:***

* Получают список валют от пользователя;
* Обновляют список валют в модели;

* Сохраняют данные о курсах валют в базу данных SQLite3;

* Извлекают актуальные данные и передают их в шаблон для отображения.

**Дополнительные требования**
* Код должен быть структурирован по принципам MVC;

* Данные должны загружаться с официального API или XML-файла Центробанка России.

* Предусмотреть обработку ошибок (например, недопустимый код валюты, недоступность сайта ЦБ);

* Для взаимодействия с API можно использовать библиотеку requests.

* Использование библиотек sqlite3 для работы с базой данных и jinja2 для шаблонов.

* Приложение должно быть запущено через Flask (flask run).

**Этапы выполнения**
1. Реализовать класс CurrencyRates (паттерн "Одиночка").

2. Реализовать контроллер для обработки запросов и сохранения данных в SQLite3.

3. Разработать шаблоны на Jinja2 для отображения информации.

4. Написать код для интеграции всех компонентов в MVC-структуре.

5. Протестировать приложение, проверив работу с разными валютами.

**Критерии оценки**
* Корректная работа паттерна "Одиночка".

* Грамотная реализация модели, представления и контроллера.

* Работа с API Центробанка и корректное извлечение данных.

* Корректное сохранение данных в SQLite3 с помощью ORM.

* Использование Jinja2 или альтернативного способа формирования View.

* Читабельность и структурированность кода.

Базовый борд с фрагментами приложения: [https://gist.github.com/nzhukov/e55b26d29d8e6422b6e15a51479ec84e](https://gist.github.com/nzhukov/e55b26d29d8e6422b6e15a51479ec84e)



**Примерная структура проекта на Flask:**
```
currency_app/

├── app.py               # Главный файл Flask-приложения

├── model.py             # Класс CurrencyRates

├── controller.py        # Логика обработки маршрутов

├── templates/           # Шаблоны Jinja2

│   ├── index.html

│   └── update.html

├── static/              # Статические файлы (если нужно)

├── database.db          # SQLite база данных

└── requirements.txt     # Список зависимостей
```

---

## Решение

### Коментарий:

Задание вызвало достаточно много сложностей из-за неполного понимания структуры задания, также во время решения происходили различные ошибки и путанница (например, удаление файла с базой данных для перезапуска приложения повлекло за собой ошибки, которые поменяли почти всю структуру проекта).

**По требованию задания у нас реализован MVC.**

***Model (model.py)***

* Принимает список кодов валют (например, ['USD', 'EUR', 'GBP']): метод set_currencies() принимает список кодов валют
* Отправляет запрос к сайту Центробанка РФ и получает данные о курсах: метод fetch_rates() отправляет запрос и парсит XML-ответ. Используется библиотека requests и BeautifulSoup для взаимодействия с API ЦБ РФ

* Реализует геттер для получения текущих отслеживаемых валют и их курсов: методы get_currencies() и get_rates()

* Реализует сеттер для изменения списка отслеживаемых валют: метод set_currencies()

* Реализован по паттерну проектирования Singleton (Одиночка) — в приложении может существовать только один экземпляр CurrencyRates: __new__


```
class CurrencyRates:
    _instance = None

    def __new__(cls, *args, **kwargs):
        if not isinstance(cls._instance, cls):
            cls._instance = object.__new__(cls)
        return cls._instance

```

* Для работы с данными и базой данных используется ORM (например, SQLAlchemy или Django ORM): используется SQLAlchemy


***View (папка templates)***

* Использует шаблонизатор Jinja2 для отображения данных: файлы index.html и update.html

* Позволяет пользователю просматривать курсы валют в удобном формате: в файле index.html отображение происходит в таблице.


***Controller (controller.py)***

* Получают список валют от пользователя: функции index и set_currencies получают список валют из формы
* Обновляют список валют в модели: метод set_currencies() модели, чтобы обновить список валют.

* Сохраняют данные о курсах валют в базу данных SQLite3: save_to_db() в model.py сохраняет данные в базу данных

* Извлекают актуальные данные и передают их в шаблон для отображения: функция index извлекает данные о курсах (currency_rates.get_rates()) и передает их в шаблон index.html

**Дополнительные требования**
* Код должен быть структурирован по принципам MVC: расписано выше

* Данные должны загружаться с официального API или XML-файла Центробанка России: model.py использует API ЦБ РФ

* Предусмотреть обработку ошибок (например, недопустимый код валюты, недоступность сайта ЦБ): Код содержит блоки try...except для обработки исключений

* Для взаимодействия с API можно использовать библиотеку requests: используется

* Использование библиотек sqlite3 для работы с базой данных и jinja2 для шаблонов: используется

* Приложение должно быть запущено через Flask (flask run): используется

**Список зависимостей (requirements.txt):** В этом файле список зависимостей, которые использовались.

### Результат

Для разработки веб-интерфейса использовался Bootstrap (папка static)

![image](https://github.com/user-attachments/assets/23926405-ee59-4711-a3a4-1febbd7b784f)

![image](https://github.com/user-attachments/assets/1efd0615-48c3-4968-bb2e-d14d3e63efdb)


**Итог**

Главная страница

![image](https://github.com/user-attachments/assets/4ff08a3f-bda3-42ad-910a-552c869cd111)

Страница обновления (пример)

![image](https://github.com/user-attachments/assets/e66bf0bf-7713-4998-ace4-66c58b5d33a1)


